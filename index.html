<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<title>Absensi Karyawan</title>

<style>
body {
    font-family: Arial;
    background: linear-gradient(135deg,#0f172a,#020617);
    color: white;
    text-align: center;
    padding: 40px;
}

.container {
    max-width: 1000px;
    margin: auto;
}

.card {
    background: #1e293b;
    padding: 25px;
    border-radius: 14px;
    display: inline-block;
    width: 300px;
    margin: 10px;
    vertical-align: top;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

input {
    padding: 12px;
    width: 90%;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    font-size: 15px;
}

button {
    padding: 12px 20px;
    margin: 8px;
    border: none;
    border-radius: 10px;
    font-size: 15px;
    cursor: pointer;
    font-weight: bold;
}

.on { background: #22c55e; color:white; }
.off { background: #ef4444; color:white; }
.logout { background: #64748b; color:white; }

.history-item {
    background: #0f172a;
    padding: 8px;
    margin: 6px 0;
    border-radius: 6px;
    font-size: 14px;
}
</style>

</head>
<body>

<div class="container">

<h2>Absensi Karyawan</h2>

<!-- LOGIN CARD -->

<div class="card" id="loginCard">
    <h3>Login</h3>
    <input type="text" id="username" placeholder="Masukkan nama">
    <br>
    <button onclick="login()">Masuk</button>
</div>

<!-- MAIN DASHBOARD -->

<div id="mainUI" style="display:none;">

```
<!-- CARD ABSENSI -->
<div class="card">
    <h3 id="welcome"></h3>
    <button class="on" onclick="onDuty()">ON DUTY</button>
    <button class="off" onclick="offDuty()">OFF DUTY</button>
    <br>
    <button class="logout" onclick="logout()">Logout</button>
</div>

<!-- TOTAL JAM -->
<div class="card">
    <h3>Total Jam Kerja</hh3>
    <h2 id="totalHours">0 jam</h2>
</div>

<!-- HISTORY -->
<div class="card">
    <h3>History Jam Kerja</h3>
    <div id="historyList">Belum ada data</div>
</div>
```

</div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbx3l8XlVqeskN4Y10bIwxp4kYFGfsqGxc3u_DWUgLNA-RUwwD_DSDMdbKM-HtlTG5sC/exec";

let user = localStorage.getItem("user");
let logs = JSON.parse(localStorage.getItem("logs") || "[]");

function saveLogs() {
    localStorage.setItem("logs", JSON.stringify(logs));
}

function login() {
    const name = document.getElementById("username").value.trim();
    if (!name) return alert("Masukkan nama");

    localStorage.setItem("user", name.toUpperCase());
    location.reload();
}

function logout() {
    localStorage.removeItem("user");
    location.reload();
}

function showUI() {
    if (user) {
        document.getElementById("loginCard").style.display = "none";
        document.getElementById("mainUI").style.display = "block";
        document.getElementById("welcome").innerText = "Halo, " + user;
    }
}

async function sendToSpreadsheet(status, keterangan="") {
    const waktu = new Date().toLocaleString();

    await fetch(API, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            nama: user,
            status,
            keterangan,
            waktu
        })
    });
}

function onDuty() {
    const now = Date.now();
    logs.push({ type: "on", time: now });
    saveLogs();
    sendToSpreadsheet("ON DUTY");
    updateStats();
    alert("ON DUTY berhasil");
}

function offDuty() {
    const ket = prompt("Kegiatan hari ini?");
    const now = Date.now();
    logs.push({ type: "off", time: now, ket });
    saveLogs();
    sendToSpreadsheet("OFF DUTY", ket);
    updateStats();
    alert("OFF DUTY berhasil");
}

function updateStats() {
    const historyDiv = document.getElementById("historyList");
    let total = 0;
    let lastOn = null;
    historyDiv.innerHTML = "";

    logs.forEach(log => {
        if (log.type === "on") {
            lastOn = log.time;
        }
        if (log.type === "off" && lastOn) {
            const dur = log.time - lastOn;
            total += dur;

            const hours = Math.floor(dur / (1000*60*60));
            const mins = Math.floor((dur/(1000*60))%60);

            const div = document.createElement("div");
            div.className = "history-item";
            div.textContent = hours + " jam " + mins + " menit";
            historyDiv.appendChild(div);

            lastOn = null;
        }
    });

    if (historyDiv.innerHTML === "") {
        historyDiv.textContent = "Belum ada data";
    }

    const totalHours = Math.floor(total / (1000*60*60));
    const totalMins = Math.floor((total/(1000*60))%60);

    document.getElementById("totalHours").textContent =
        totalHours + " jam " + totalMins + " menit";
}

showUI();
updateStats();
</script>

</body>
</html>
